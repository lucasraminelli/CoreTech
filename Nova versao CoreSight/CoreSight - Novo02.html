<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MFGV CoreSight | Diagn√≥stico Estrat√©gico v6.1 Integrated</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 
                        sans: ['Inter', 'sans-serif'], 
                        mono: ['"JetBrains Mono"', 'monospace'] 
                    },
                    colors: {
                        mfgv: { deep: '#032c7c', mid: '#1e40af', cyan: '#00bcd4', surface: '#ffffff', danger: '#ef4444', success: '#10b981', warning: '#f59e0b' }
                    },
                    screens: { 'xs': '375px' }
                }
            }
        }
    </script>

    <style>
        /* BASE STYLES */
        body {
            background-color: #032c7c;
            background-image: linear-gradient(135deg, #01184a 0%, #032c7c 100%);
            color: #1e293b;
            -webkit-font-smoothing: antialiased;
        }

        /* GLASSMORPHISM */
        .glass-panel {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* STEPS ANIMATION */
        .step-content { display: none; }
        .step-content.active { display: block; animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* CUSTOM INPUTS & BUTTONS */
        .q-btn { 
            transition: all 0.2s; 
            border: 1px solid #e2e8f0; 
            touch-action: manipulation;
        }
        .q-btn:active { transform: scale(0.98); }
        .q-btn.selected { 
            background: #032c7c; 
            color: white; 
            border-color: #032c7c; 
            box-shadow: 0 4px 12px rgba(3, 44, 124, 0.2); 
        }

        /* PRINT STYLES (RELAT√ìRIO EXECUTIVO) */
        @media print {
            body { background: white; color: black; display: block; }
            .no-print { display: none !important; }
            .glass-panel { box-shadow: none; border: none; width: 100%; max-width: 100%; height: auto; border-radius: 0; }
            .print-break { page-break-before: always; }
            #main-scroll { overflow: visible; padding: 0; }
            .print-header { display: flex !important; margin-bottom: 20px; border-bottom: 2px solid #032c7c; padding-bottom: 10px; }
            /* Force colors */
            .text-mfgv-deep { color: #032c7c !important; }
            .bg-mfgv-deep { background-color: #032c7c !important; color: white !important; -webkit-print-color-adjust: exact; }
            .bg-red-50 { background-color: #fef2f2 !important; -webkit-print-color-adjust: exact; }
            .bg-emerald-50 { background-color: #ecfdf5 !important; -webkit-print-color-adjust: exact; }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-0 md:p-4 lg:p-6 font-sans">

    <div class="w-full max-w-[1600px] h-screen md:h-[95vh] flex md:rounded-3xl overflow-hidden relative bg-white glass-panel shadow-2xl">
        
        <div class="w-[280px] lg:w-[320px] bg-[#032c7c] text-white flex-shrink-0 flex flex-col justify-between p-6 lg:p-8 relative z-20 hidden md:flex">
            <div>
                <div class="flex items-center gap-3 mb-10">
                    <div class="w-10 h-10 bg-mfgv-cyan rounded-lg flex items-center justify-center text-mfgv-deep font-bold text-xl shadow-lg">
                        <i class="fa-solid fa-chart-pie"></i>
                    </div>
                    <div>
                        <h1 class="font-bold text-lg leading-tight">MFGV<br><span class="text-mfgv-cyan font-normal">CoreSight‚Ñ¢ v6</span></h1>
                    </div>
                </div>

                <nav class="space-y-4 lg:space-y-6 relative pl-4 border-l border-white/10">
                    <div id="progress-marker" class="absolute left-[-2px] top-0 w-[3px] h-6 bg-mfgv-cyan transition-all duration-500 rounded-full"></div>
                    <div class="step-link text-sm font-medium text-mfgv-cyan cursor-pointer" onclick="jumpTo(0)">01. Contexto</div>
                    <div class="step-link text-sm font-medium opacity-50 cursor-pointer" onclick="jumpTo(1)">02. Estrutura</div>
                    <div class="step-link text-sm font-medium opacity-50 cursor-pointer" onclick="jumpTo(2)">03. TCO Audit</div>
                    <div class="step-link text-sm font-medium opacity-50 cursor-pointer" onclick="jumpTo(3)">04. Financeiro</div>
                    <div class="step-link text-sm font-medium opacity-50 cursor-pointer" onclick="jumpTo(4)">05. Risco</div>
                    <div class="step-link text-sm font-medium opacity-50 cursor-pointer" onclick="jumpTo(5)">06. Operacional</div>
                    <div class="step-link text-sm font-medium opacity-50" id="link-final" onclick="jumpTo(6)">07. Relat√≥rio</div>
                </nav>
            </div>
            
            <div class="bg-white/10 p-4 rounded-xl border border-white/5 backdrop-blur-sm">
                <div class="flex items-center gap-2 text-mfgv-cyan mb-2 text-[10px] font-bold uppercase tracking-wider">
                    <i class="fa-solid fa-calculator"></i> Estimativa Din√¢mica
                </div>
                <div class="flex justify-between items-end">
                    <span class="text-xs text-blue-100">Custo Folha/Ano:</span>
                    <span class="text-sm font-mono font-bold text-white" id="sidebar-payroll">R$ 0</span>
                </div>
            </div>
        </div>

        <div class="flex-1 flex flex-col relative bg-white overflow-hidden">
            
            <div class="md:hidden h-14 border-b border-slate-100 flex items-center justify-between px-4 bg-white z-10">
                <span class="font-bold text-mfgv-deep">MFGV CoreSight</span>
                <span class="text-xs font-bold text-slate-400" id="mob-step-counter">1/7</span>
            </div>
            <div class="md:hidden h-1 w-full bg-slate-100">
                <div id="mobile-progress" class="h-full bg-mfgv-cyan w-[14%] transition-all duration-500"></div>
            </div>

            <div class="flex-1 overflow-y-auto p-4 md:p-8 lg:p-12 scroll-smooth" id="main-scroll">
                
                <div class="print-header hidden flex-col">
                    <div class="flex justify-between items-center">
                        <h1 class="text-2xl font-bold text-[#032c7c]">RELAT√ìRIO EXECUTIVO DE DIAGN√ìSTICO</h1>
                        <span class="text-sm text-slate-500" id="print-date">Data: 12/01/2026</span>
                    </div>
                    <p class="text-sm text-slate-600">Confidencial ‚Ä¢ Gerado por MFGV CoreSight</p>
                </div>

                <div id="step-0" class="step-content active max-w-4xl mx-auto py-4 md:py-10">
                    <span class="inline-block px-3 py-1 rounded-full bg-blue-50 text-mfgv-deep text-[10px] md:text-xs font-bold uppercase mb-4">Auditoria 2026</span>
                    <h2 class="text-3xl md:text-5xl font-extrabold text-slate-900 mb-2 tracking-tight">Qual o perfil da opera√ß√£o?</h2>
                    <p class="text-slate-500 mb-8 md:mb-12">Isso define os benchmarks de risco e produtividade.</p>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
                        <button onclick="setContext('AGRO', this)" class="ctx-btn group p-6 rounded-2xl border-2 border-slate-100 hover:border-mfgv-deep hover:bg-blue-50/30 transition-all text-left relative overflow-hidden">
                            <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity"><i class="fa-solid fa-tractor text-6xl text-slate-900"></i></div>
                            <span class="block text-2xl mb-2">üåæ</span>
                            <h3 class="text-lg font-bold text-slate-800">Agroneg√≥cio</h3>
                            <p class="text-xs text-slate-500 mt-1">Produtores, Bioenergia.</p>
                        </button>
                        <button onclick="setContext('INDUSTRIAL', this)" class="ctx-btn group p-6 rounded-2xl border-2 border-slate-100 hover:border-mfgv-deep hover:bg-blue-50/30 transition-all text-left relative overflow-hidden">
                            <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity"><i class="fa-solid fa-industry text-6xl text-slate-900"></i></div>
                            <span class="block text-2xl mb-2">üè≠</span>
                            <h3 class="text-lg font-bold text-slate-800">Ind√∫stria</h3>
                            <p class="text-xs text-slate-500 mt-1">Manufatura, Log√≠stica.</p>
                        </button>
                        <button onclick="setContext('CORPORATE', this)" class="ctx-btn group p-6 rounded-2xl border-2 border-slate-100 hover:border-mfgv-deep hover:bg-blue-50/30 transition-all text-left relative overflow-hidden">
                            <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity"><i class="fa-solid fa-building text-6xl text-slate-900"></i></div>
                            <span class="block text-2xl mb-2">üè¢</span>
                            <h3 class="text-lg font-bold text-slate-800">Corporate</h3>
                            <p class="text-xs text-slate-500 mt-1">Servi√ßos, Varejo, Tech.</p>
                        </button>
                    </div>
                </div>

                <div id="step-1" class="step-content max-w-4xl mx-auto py-4 md:py-8">
                    <h2 class="text-2xl md:text-3xl font-bold text-slate-900 mb-2">Estrutura & Departamentos</h2>
                    <p class="text-slate-500 mb-8">Defina a estrutura organizacional para um diagn√≥stico preciso.</p>
                    
                    <div class="bg-white p-6 md:p-8 rounded-2xl border border-slate-200 shadow-sm mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="text-xs font-bold text-slate-400 uppercase">Nome da Empresa</label>
                                <input type="text" id="inp-company" class="w-full py-3 border-b-2 border-slate-100 focus:border-mfgv-deep outline-none text-lg font-medium" placeholder="Ex: Grupo Alpha">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-slate-400 uppercase">Respons√°vel</label>
                                <input type="text" id="inp-name" class="w-full py-3 border-b-2 border-slate-100 focus:border-mfgv-deep outline-none text-lg font-medium" placeholder="Seu Nome">
                            </div>
                        </div>
                    </div>

                    <div class="bg-slate-50 p-6 md:p-8 rounded-2xl border border-slate-200 shadow-sm space-y-6 relative overflow-hidden">
                        <div class="absolute right-0 top-0 w-32 h-32 bg-blue-100 opacity-20 rounded-bl-full pointer-events-none"></div>
                        
                        <div class="flex items-center gap-2 mb-2">
                            <div class="w-8 h-8 rounded bg-mfgv-deep text-white flex items-center justify-center"><i class="fa-solid fa-sitemap"></i></div>
                            <h3 class="font-bold text-slate-800 text-lg">Mapeamento de Setores</h3>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-12 gap-4 items-end bg-white p-4 rounded-xl border border-slate-200">
                            <div class="md:col-span-5">
                                <label class="text-xs font-bold text-slate-400 uppercase">Nome do Setor</label>
                                <input type="text" id="dept-name" class="w-full py-2 border-b border-slate-200 focus:border-mfgv-deep outline-none text-sm font-medium" placeholder="Ex: Opera√ß√£o, TI, RH">
                            </div>
                            <div class="md:col-span-2">
                                <label class="text-xs font-bold text-slate-400 uppercase">Qtd. Pessoas</label>
                                <input type="number" id="dept-count" class="w-full py-2 border-b border-slate-200 focus:border-mfgv-deep outline-none text-sm font-medium" placeholder="0">
                            </div>
                            <div class="md:col-span-3">
                                <label class="text-xs font-bold text-slate-400 uppercase">Sal√°rio M√©dio (R$)</label>
                                <input type="number" id="dept-salary" class="w-full py-2 border-b border-slate-200 focus:border-mfgv-deep outline-none text-sm font-medium" placeholder="0.00">
                            </div>
                            <div class="md:col-span-2">
                                <button onclick="addDepartment()" class="w-full py-2 bg-mfgv-deep text-white rounded-lg font-bold text-sm hover:bg-blue-800 transition-all shadow">
                                    <i class="fa-solid fa-plus mr-1"></i> Adicionar
                                </button>
                            </div>
                        </div>

                        <div class="overflow-hidden rounded-xl border border-slate-200 bg-white shadow-sm min-h-[100px]">
                            <table class="w-full text-sm text-left">
                                <thead class="text-xs text-slate-500 uppercase bg-slate-100 border-b border-slate-200">
                                    <tr>
                                        <th class="px-4 py-3">Departamento</th>
                                        <th class="px-4 py-3 text-center">Colaboradores</th>
                                        <th class="px-4 py-3 text-right">Sal√°rio M√©dio</th>
                                        <th class="px-4 py-3 text-right">Folha Mensal</th>
                                        <th class="px-4 py-3 text-center">A√ß√£o</th>
                                    </tr>
                                </thead>
                                <tbody id="departments-list-body" class="divide-y divide-slate-100">
                                    <tr id="empty-dept-msg">
                                        <td colspan="5" class="px-4 py-8 text-center text-slate-400 italic">
                                            Nenhum departamento adicionado. Adicione acima para come√ßar.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="flex flex-col md:flex-row justify-between items-center gap-4 pt-4 border-t border-slate-200">
                            <div class="flex items-center gap-3">
                                <div class="bg-blue-100 p-2 rounded-lg text-mfgv-deep"><i class="fa-solid fa-users"></i></div>
                                <div>
                                    <p class="text-[10px] text-slate-500 uppercase font-bold">Total Colaboradores</p>
                                    <h4 class="text-xl font-bold font-mono text-slate-800" id="total-employees-display">0</h4>
                                </div>
                            </div>
                            <div class="flex items-center gap-3">
                                <div class="bg-emerald-100 p-2 rounded-lg text-emerald-700"><i class="fa-solid fa-money-bill-wave"></i></div>
                                <div>
                                    <p class="text-[10px] text-slate-500 uppercase font-bold">M√©dia Salarial Global (Pond.)</p>
                                    <h4 class="text-xl font-bold font-mono text-slate-800" id="avg-salary-display">R$ 0,00</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4 flex items-center gap-3 p-4 bg-white rounded-xl border border-slate-100">
                        <input type="checkbox" id="inp-multisite" class="w-5 h-5 text-mfgv-deep rounded focus:ring-mfgv-deep" onchange="updateState()">
                        <label for="inp-multisite" class="text-sm text-slate-700 font-medium">Opera√ß√£o Multi-site / Filiais (Aumenta complexidade)</label>
                    </div>
                </div>

                <div id="step-2" class="step-content max-w-4xl mx-auto py-4 md:py-8">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="p-2 bg-mfgv-deep text-white rounded shadow"><i class="fa-solid fa-file-invoice-dollar"></i></div>
                        <h2 class="text-2xl font-bold text-slate-900">Custo Real da For√ßa de Trabalho</h2>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                        <div class="lg:col-span-3 bg-slate-50 p-6 rounded-2xl border border-slate-200">
                            <label class="text-xs font-bold text-mfgv-deep uppercase mb-2 block">Faturamento Anual (R$)</label>
                            <input type="text" id="inp-revenue" class="w-full bg-transparent text-3xl md:text-4xl font-bold font-mono text-slate-800 outline-none placeholder-slate-300" placeholder="0,00" oninput="formatCurrency(this); updateState()">
                            <p class="text-xs text-slate-400 mt-2">Usado para c√°lculo de HCROI (Efici√™ncia do Capital Humano)</p>
                        </div>

                        <div class="p-5 border border-slate-200 rounded-xl bg-slate-100 shadow-sm opacity-80" title="Calculado na etapa anterior">
                            <label class="text-xs font-bold text-slate-400 uppercase">Sal√°rio M√©dio Base (Calc.)</label>
                            <div class="flex items-center mt-2">
                                <span class="text-slate-400 mr-2">R$</span>
                                <input type="number" id="inp-salary" class="w-full text-xl font-bold font-mono outline-none bg-transparent" value="0" readonly>
                            </div>
                        </div>

                        <div class="p-5 border border-slate-200 rounded-xl bg-white shadow-sm">
                            <label class="text-xs font-bold text-slate-400 uppercase">Regime Tribut√°rio</label>
                            <select id="inp-tax" class="w-full mt-2 bg-transparent font-bold text-slate-700 outline-none" onchange="updateState()">
                                <option value="1.35">Simples Nacional (1.35x)</option>
                                <option value="1.60">Lucro Presumido (1.60x)</option>
                                <option value="1.75">Lucro Real (1.75x)</option>
                            </select>
                        </div>

                        <div class="p-5 border border-slate-200 rounded-xl bg-white shadow-sm">
                            <label class="text-xs font-bold text-slate-400 uppercase">Benef√≠cios/M√™s (M√©dio)</label>
                            <div class="flex items-center mt-2">
                                <span class="text-slate-400 mr-2">R$</span>
                                <input type="number" id="inp-benefits" class="w-full text-xl font-bold font-mono outline-none" value="800" oninput="updateState()">
                            </div>
                        </div>
                    </div>

                    <div class="bg-slate-900 text-white p-6 rounded-2xl shadow-xl flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                        <div>
                            <p class="text-xs text-blue-300 uppercase font-bold tracking-wider">Custo Total Folha (Anual)</p>
                            <h3 class="text-2xl md:text-3xl font-mono font-bold" id="disp-annual-payroll">R$ 0,00</h3>
                            <p class="text-[10px] text-slate-400 mt-1">Inclui 13¬∫, F√©rias (1/3), Encargos e Benef√≠cios</p>
                        </div>
                        <div class="md:text-right">
                            <p class="text-xs text-blue-300 uppercase font-bold tracking-wider">Custo Real / Colaborador</p>
                            <h3 class="text-xl font-mono text-mfgv-cyan" id="disp-monthly-cost">R$ 0,00 /m√™s</h3>
                        </div>
                    </div>
                </div>

                <div id="step-3" class="step-content max-w-4xl mx-auto py-4">
                    <div class="flex items-center gap-3 mb-6"><div class="p-2 bg-red-100 text-red-600 rounded"><i class="fa-solid fa-chart-line"></i></div><h2 class="text-2xl font-bold text-slate-900">Indicadores Financeiros</h2></div>
                    <div id="fin-questions-container" class="space-y-6"></div>
                </div>

                <div id="step-4" class="step-content max-w-4xl mx-auto py-4">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="p-2 bg-orange-100 text-orange-600 rounded">
                            <i class="fa-solid fa-triangle-exclamation"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-slate-900">An√°lise de Risco Cultural</h2>
                    </div>
                    
                    <p class="text-slate-500 mb-6">Quantifique o comportamento da equipe por departamento. Isso afeta diretamente o custo de Turnover e Inefici√™ncia.</p>

                    <div id="risk-cards-container" class="space-y-4">
                        </div>
                </div>

                <div id="step-5" class="step-content max-w-4xl mx-auto py-4">
                    <div class="flex items-center gap-3 mb-6"><div class="p-2 bg-emerald-100 text-emerald-600 rounded"><i class="fa-solid fa-users-gear"></i></div><h2 class="text-2xl font-bold text-slate-900">Indicadores Operacionais</h2></div>
                    <div id="ops-questions-container" class="space-y-6"></div>
                </div>

                <div id="loading-screen" class="hidden absolute inset-0 bg-white z-50 flex flex-col items-center justify-center">
                    <div class="w-16 h-16 border-4 border-slate-100 border-t-mfgv-deep rounded-full animate-spin mb-4"></div>
                    <h3 class="text-xl font-bold text-mfgv-deep">Calculando TCWL & ROI...</h3>
                    <p class="text-sm text-slate-400 mt-2">Cruzando dados com benchmark setorial...</p>
                </div>

                <div id="step-6" class="step-content h-full pb-20">
                    
                    <div class="bg-white border-b border-slate-200 pb-8 mb-8">
                        <div class="flex flex-col md:flex-row justify-between md:items-end gap-4">
                            <div>
                                <span class="inline-block px-2 py-1 bg-slate-100 text-[10px] font-bold uppercase rounded text-slate-500 mb-2">Diagn√≥stico Executivo</span>
                                <h1 class="text-3xl md:text-4xl font-extrabold text-slate-900 leading-tight">Relat√≥rio de Efici√™ncia <br><span class="text-mfgv-deep" id="res-company">Empresa</span></h1>
                            </div>
                            <div class="text-left md:text-right">
                                <p class="text-xs font-bold text-slate-400 uppercase">Score de Sa√∫de</p>
                                <div class="text-4xl font-black text-slate-800" id="res-score">0/100</div>
                                <div class="text-sm font-bold" id="res-status">Calculando...</div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                        <div class="p-5 bg-red-50 rounded-xl border border-red-100">
                            <p class="text-[10px] font-bold text-red-600 uppercase mb-1">Perda Anual (TCWL)</p>
                            <h3 class="text-2xl font-mono font-bold text-red-700" id="res-tcwl">R$ 0</h3>
                        </div>
                        <div class="p-5 bg-emerald-50 rounded-xl border border-emerald-100">
                            <p class="text-[10px] font-bold text-emerald-600 uppercase mb-1">Potencial Recupera√ß√£o</p>
                            <h3 class="text-2xl font-mono font-bold text-emerald-700" id="res-recovery">R$ 0</h3>
                            <p class="text-[10px] text-emerald-600 mt-1 font-bold">+30% Efici√™ncia</p>
                        </div>
                        <div class="p-5 bg-white rounded-xl border border-slate-200 shadow-sm">
                            <p class="text-[10px] font-bold text-slate-400 uppercase mb-1">HC ROI Atual</p>
                            <h3 class="text-2xl font-mono font-bold text-slate-700" id="res-hcroi">0.0x</h3>
                        </div>
                         <div class="p-5 bg-white rounded-xl border border-slate-200 shadow-sm">
                            <p class="text-[10px] font-bold text-mfgv-deep uppercase mb-1">ROI do Projeto</p>
                            <h3 class="text-2xl font-mono font-bold text-mfgv-deep" id="res-project-roi">0%</h3>
                            <p class="text-[10px] text-slate-400 mt-1">Payback: <span id="res-payback">0</span> meses</p>
                        </div>
                    </div>

                    <div class="bg-gradient-to-r from-[#667eea] to-[#764ba2] text-white p-6 rounded-2xl mb-8 shadow-lg">
                        <h3 class="font-bold text-lg mb-4 flex items-center gap-2"><i class="fa-solid fa-scale-balanced"></i> O Dilema: Resolver vs Ignorar</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white/10 p-4 rounded-xl border border-white/10 backdrop-blur-sm">
                                <p class="text-xs uppercase font-bold text-blue-100 mb-1">üíâ Custo da Cirurgia (Sa√≠da)</p>
                                <h4 class="text-2xl font-mono font-bold" id="res-surgery-cost">R$ 0</h4>
                                <p class="text-[10px] text-blue-200 mt-2">Custo de rescis√£o e reposi√ß√£o de colaboradores t√≥xicos.</p>
                            </div>
                            <div class="bg-red-500/20 p-4 rounded-xl border border-red-500/30 backdrop-blur-sm">
                                <p class="text-xs uppercase font-bold text-red-100 mb-1">ü©∏ Custo da Sangria (Inefici√™ncia)</p>
                                <h4 class="text-2xl font-mono font-bold text-red-50" id="res-bleeding-cost">R$ 0</h4>
                                <p class="text-[10px] text-red-100 mt-2">Custo anual de manter a equipe contaminada e improdutiva.</p>
                            </div>
                        </div>
                        <p class="text-center text-sm mt-4 font-medium opacity-90" id="res-insight-text">Analisando...</p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8 print-break">
                        <div class="lg:col-span-1 bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                            <h4 class="font-bold text-slate-700 mb-4">Composi√ß√£o das Perdas</h4>
                            <div class="relative h-64">
                                <canvas id="breakdownChart"></canvas>
                            </div>
                        </div>
                        <div class="lg:col-span-2 bg-white p-6 rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
                            <h4 class="font-bold text-slate-700 mb-4">Detalhamento dos Custos Ocultos</h4>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm text-left">
                                    <thead class="text-xs text-slate-400 uppercase bg-slate-50 border-b border-slate-100">
                                        <tr><th class="px-4 py-3">Fonte de Perda</th><th class="px-4 py-3 text-right">Impacto Anual</th><th class="px-4 py-3 text-right">% Folha</th></tr>
                                    </thead>
                                    <tbody id="table-body" class="divide-y divide-slate-100">
                                        </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="bg-[#032c7c] rounded-3xl p-8 text-white relative overflow-hidden print-break shadow-2xl">
                        <div class="absolute right-0 top-0 w-64 h-64 bg-[#00bcd4] opacity-10 rounded-full blur-3xl -mr-16 -mt-16"></div>
                        
                        <div class="relative z-10 flex flex-col md:flex-row justify-between gap-8">
                            <div class="flex-1">
                                <div class="inline-block px-3 py-1 bg-white/10 border border-white/20 rounded-full text-[10px] font-bold uppercase mb-4">Plano Recomendado 2026</div>
                                <h3 class="text-4xl font-bold mb-2" id="plan-name">PLAN NAME</h3>
                                <p class="text-blue-200 text-lg mb-6" id="plan-desc">Description</p>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-white/5 p-4 rounded-xl border border-white/5">
                                        <h5 class="font-bold text-mfgv-cyan mb-2 text-sm"><i class="fa-solid fa-microchip mr-2"></i>Tech Stack</h5>
                                        <ul class="text-sm text-blue-100 space-y-1" id="plan-tech"></ul>
                                    </div>
                                    <div class="bg-white/5 p-4 rounded-xl border border-white/5">
                                        <h5 class="font-bold text-mfgv-cyan mb-2 text-sm"><i class="fa-solid fa-users mr-2"></i>Consultoria Core</h5>
                                        <ul class="text-sm text-blue-100 space-y-1" id="plan-core"></ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="md:w-1/3 bg-white text-slate-900 rounded-2xl p-6 shadow-lg flex flex-col justify-center">
                                <p class="text-xs font-bold text-slate-400 uppercase text-center mb-2">Investimento Estimado</p>
                                <h4 class="text-3xl font-mono font-bold text-center text-mfgv-deep mb-1" id="plan-price">R$ 0k</h4>
                                <p class="text-xs text-center text-slate-400 mb-6">Mensal / Contrato Anual</p>
                                <button onclick="window.print()" class="w-full py-3 bg-mfgv-deep text-white font-bold rounded-xl hover:bg-blue-800 transition-all no-print shadow-lg">
                                    <i class="fa-solid fa-print mr-2"></i> Salvar PDF
                                </button>
                                <p class="text-[10px] text-center text-slate-400 mt-4 no-print">V√°lido por 15 dias.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-8 text-center text-[10px] text-slate-400">
                        <p>MFGV CoreSight v6.1 ‚Ä¢ Algoritmo Audit√°vel ‚Ä¢ Baseado em Benchmark Brasil 2025</p>
                    </div>

                </div>

            </div>

            <div class="p-4 md:p-6 border-t border-slate-100 bg-white/90 backdrop-blur flex justify-between items-center z-30 no-print" id="nav-footer">
                <button id="btn-back" class="text-slate-400 hover:text-mfgv-deep font-semibold text-sm flex items-center gap-2 px-4 py-2 opacity-0 pointer-events-none">Voltar</button>
                <button id="btn-next" class="bg-mfgv-deep text-white px-6 md:px-8 py-3 rounded-xl font-bold text-sm shadow-lg hover:shadow-xl hover:translate-y-[-2px] transition-all flex items-center gap-2">
                    Continuar <i class="fa-solid fa-arrow-right"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // === CONFIGURATION ===
        const CONFIG = {
            QUESTIONS: {
                FIN: [
                    { id: 'q1', text: 'Taxa de Turnover Anual Estimada', opts: ['>30% (Cr√≠tico)', '20-30%', '10-20%', '5-10%', '<5% (Excelente)'], vals: [0.35, 0.225, 0.115, 0.065, 0.03] },
                    { id: 'q2', text: 'Plano de Sucess√£o Formalizado', opts: ['Inexistente', 'Informal', 'Parcial', 'Estruturado', 'Completo'], vals: [1.15, 1.15, 1.05, 1.02, 1.0] },
                    { id: 'q3', text: 'Voc√™ sabe o Custo de Substitui√ß√£o?', opts: ['N√£o tenho ideia', 'Vaga no√ß√£o', 'Parcial', 'Calculado', 'Preciso'], vals: [1,1,1,1,1] }, 
                    { id: 'q4', text: 'Controle de Absente√≠smo', opts: ['Nenhum', 'Manual', 'B√°sico', 'Sist√™mico', 'Preditivo'], vals: [1.8, 1.5, 1.2, 1.0, 0.7] },
                    { id: 'q5', text: 'Integra√ß√£o RH x Finan√ßas', opts: ['Silos', 'Planilha', 'Parcial', 'Integrado', 'Tempo Real'], vals: [1.2, 1.15, 1.1, 1.05, 1.0] },
                    { id: 'q6', text: 'C√°lculo de ROI em Treinamentos', opts: ['Nunca', 'Raramente', '√Äs vezes', 'Sempre', 'Autom√°tico'], vals: [0.25, 0.18, 0.10, 0.03, 0.01] },
                    { id: 'q7', text: 'Seguran√ßa para Apontar Erros', opts: ['Medo Total', 'Receio', 'Neutro', 'Seguro', 'Cultura de Erro'], vals: [0.12, 0.08, 0.04, 0.02, 0.0] }
                ],
                OPS: [
                    { id: 'o1', text: 'Lideran√ßa promove cultura?', opts: ['Inexistente', 'Fraca', 'Parcial', 'Forte', 'Exemplar'], vals: [1.25, 1.2, 1.1, 1.0, 1.0] },
                    { id: 'o2', text: 'Programa de Reconhecimento', opts: ['Zero', 'Ad-hoc', 'B√°sico', 'Estruturado', 'Gamificado'], vals: [0.10, 0.08, 0.04, 0.02, 0.0] },
                    { id: 'o3', text: 'Suporte √† Sa√∫de Mental', opts: ['Nenhum', 'Reativo', 'B√°sico', 'Preventivo', 'Hol√≠stico'], vals: [0.06, 0.04, 0.02, 0.01, 0.0] },
                    { id: 'o4', text: 'Tempo Onboarding (Produtividade)', opts: ['7 meses', '5 meses', '3 meses', '1.5 meses', '0.5 m√™s'], vals: [7, 5, 3, 1.5, 0.5] },
                    { id: 'o5', text: '% Reuni√µes Improdutivas (Est.)', type: 'number', suffix: '%', def: 25 },
                    { id: 'o6', text: 'Horas/Semana Burocracia Digital', type: 'number', suffix: 'h', def: 4 }
                ]
            },
            PLANS: {
                STARTER: { name: 'STARTER', desc: 'Para estrutura√ß√£o inicial (50-150 vidas)', minPrice: 15, maxPrice: 20, tech: ['CoreHuman Basic', 'CoreFlow Pilot', 'Strategy Hub Lite'], core: ['Diagn√≥stico Completo', 'Protocolo Deep Work', 'Treino Lideran√ßa'] },
                GROWTH: { name: 'GROWTH', desc: 'Para expans√£o e efici√™ncia (150-500 vidas)', minPrice: 39, maxPrice: 58, tech: ['CoreHuman Full', 'CoreFlow Nexus', 'Strategy Hub Pro', 'ML B√°sico'], core: ['Diagn√≥stico 5 dias', 'Coaching Lideran√ßa', 'Prog. Reten√ß√£o'] },
                ENTERPRISE: { name: 'ENTERPRISE', desc: 'Escala e Governan√ßa (500+ vidas)', minPrice: 115, maxPrice: 165, tech: ['CoreHuman Ent.', 'CoreFlow Full Stack', 'Strategy Ent. + ML Adv.', 'Suporte 24/7'], core: ['Diagn√≥stico 10 dias', 'Transf. Cultural', 'Consultoria C-Level'] }
            }
        };

        let state = {
            step: 0,
            ctx: null,
            data: { emp: 0, sal: 0, ben: 800, tax: 1.35, rev: 0, multi: false },
            departments: [], 
            ans: { fin: [], ops: [] }, 
            res: {}
        };

        // === INITIALIZATION ===
        function init() {
            renderQuestions();
            updateState();
        }

        function renderQuestions() {
            // Finance
            const fCont = document.getElementById('fin-questions-container');
            fCont.innerHTML = CONFIG.QUESTIONS.FIN.map((q, idx) => `
                <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                    <p class="font-bold text-slate-700 text-sm mb-3">${idx+1}. ${q.text}</p>
                    <div class="grid grid-cols-2 md:grid-cols-5 gap-2">
                        ${q.opts.map((opt, i) => `<button onclick="setAns('fin', ${idx}, ${i}, this)" class="q-btn py-2 px-1 text-[10px] md:text-xs rounded font-medium text-slate-500 bg-white">${opt}</button>`).join('')}
                    </div>
                </div>
            `).join('');

            // Ops
            const oCont = document.getElementById('ops-questions-container');
            oCont.innerHTML = CONFIG.QUESTIONS.OPS.map((q, idx) => {
                if(q.type === 'number') {
                    return `
                    <div class="bg-slate-50 p-4 rounded-xl border border-slate-200 flex justify-between items-center">
                        <label class="font-bold text-slate-700 text-sm">${idx+1}. ${q.text}</label>
                        <div class="flex items-center bg-white border border-slate-300 rounded px-3 py-2 w-32">
                            <input type="number" class="w-full outline-none text-right font-bold text-mfgv-deep" value="${q.def}" onchange="setAns('ops', ${idx}, this.value, null)">
                            <span class="text-xs text-slate-400 ml-1">${q.suffix}</span>
                        </div>
                    </div>`;
                } else {
                    return `
                    <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                        <p class="font-bold text-slate-700 text-sm mb-3">${idx+1}. ${q.text}</p>
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-2">
                            ${q.opts.map((opt, i) => `<button onclick="setAns('ops', ${idx}, ${i}, this)" class="q-btn py-2 px-1 text-[10px] md:text-xs rounded font-medium text-slate-500 bg-white">${opt}</button>`).join('')}
                        </div>
                    </div>`;
                }
            }).join('');
        }

        // === DEPARTMENT MANAGEMENT ===
        window.addDepartment = () => {
            const name = document.getElementById('dept-name').value.trim();
            const count = parseInt(document.getElementById('dept-count').value);
            const salary = parseFloat(document.getElementById('dept-salary').value);

            if(!name || !count || !salary || count <= 0) {
                alert("Por favor, preencha corretamente os dados do departamento.");
                return;
            }

            // Init with 0 risk
            state.departments.push({ id: Date.now(), name, count, salary, total: count * salary, risk: { toxic: 0, contaminated: 0 } });
            
            document.getElementById('dept-name').value = '';
            document.getElementById('dept-count').value = '';
            document.getElementById('dept-salary').value = '';
            
            renderDepartments();
            updateState();
        }

        window.removeDepartment = (id) => {
            state.departments = state.departments.filter(d => d.id !== id);
            renderDepartments();
            updateState();
        }

        window.renderDepartments = () => {
            const tbody = document.getElementById('departments-list-body');
            if(state.departments.length === 0) {
                tbody.innerHTML = `<tr id="empty-dept-msg"><td colspan="5" class="px-4 py-8 text-center text-slate-400 italic">Nenhum departamento adicionado.</td></tr>`;
                return;
            }

            tbody.innerHTML = state.departments.map(d => `
                <tr class="bg-white hover:bg-slate-50 border-b border-slate-50 transition-colors">
                    <td class="px-4 py-3 font-medium text-slate-800">${d.name}</td>
                    <td class="px-4 py-3 text-center text-slate-600">${d.count}</td>
                    <td class="px-4 py-3 text-right text-slate-600 font-mono text-xs">R$ ${d.salary.toFixed(2)}</td>
                    <td class="px-4 py-3 text-right text-slate-600 font-mono text-xs font-bold">R$ ${d.total.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                    <td class="px-4 py-3 text-center">
                        <button onclick="removeDepartment(${d.id})" class="text-red-400 hover:text-red-600 text-xs py-1 px-2 rounded hover:bg-red-50"><i class="fa-solid fa-trash"></i></button>
                    </td>
                </tr>
            `).join('');
        }

        // === RISK MANAGEMENT LOGIC (STEP 5) ===
        window.renderRiskStep = () => {
            const container = document.getElementById('risk-cards-container');
            if(state.departments.length === 0) {
                container.innerHTML = '<div class="p-4 bg-yellow-50 text-yellow-600 rounded">Adicione departamentos na etapa "Estrutura" primeiro.</div>';
                return;
            }

            container.innerHTML = state.departments.map(dept => `
                <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                    <div class="flex justify-between items-center mb-4 border-b border-slate-50 pb-2">
                        <h4 class="font-bold text-mfgv-deep">${dept.name}</h4>
                        <span class="text-xs text-slate-400 bg-slate-100 px-2 py-1 rounded">Total: ${dept.count} pessoas</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="text-[10px] font-bold text-red-500 uppercase block mb-1">Colaboradores T√≥xicos</label>
                            <input type="number" min="0" max="${dept.count}" 
                                value="${dept.risk.toxic || 0}"
                                onchange="updateRisk(${dept.id}, 'toxic', this.value)"
                                class="w-full border border-red-200 focus:border-red-500 rounded px-3 py-2 text-sm font-bold text-red-600 outline-none">
                            <p class="text-[10px] text-slate-400 mt-1">Sabotadores ativos</p>
                        </div>
                        <div>
                            <label class="text-[10px] font-bold text-orange-400 uppercase block mb-1">Colaboradores Contaminados</label>
                            <input type="number" min="0" max="${dept.count}" 
                                value="${dept.risk.contaminated || 0}"
                                onchange="updateRisk(${dept.id}, 'cont', this.value)"
                                class="w-full border border-orange-200 focus:border-orange-500 rounded px-3 py-2 text-sm font-bold text-orange-600 outline-none">
                            <p class="text-[10px] text-slate-400 mt-1">Baixo engajamento</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        window.updateRisk = (id, type, val) => {
            const dept = state.departments.find(d => d.id === id);
            if(dept) {
                const num = parseInt(val) || 0;
                if(type === 'toxic') dept.risk.toxic = num;
                if(type === 'cont') dept.risk.contaminated = num;
            }
        }

        // === GENERAL LOGIC ===
        window.setContext = (ctx, btn) => {
            state.ctx = ctx;
            document.querySelectorAll('.ctx-btn').forEach(b => b.classList.remove('border-mfgv-deep', 'bg-blue-50/30'));
            btn.classList.add('border-mfgv-deep', 'bg-blue-50/30');
            setTimeout(() => jumpTo(1), 300);
        }

        window.setAns = (type, qIdx, val, btn) => {
            state.ans[type][qIdx] = val;
            if(btn) {
                const p = btn.parentElement;
                p.querySelectorAll('button').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
            }
        }

        window.updateState = () => {
            let totalEmp = 0;
            let totalMonthlyPayroll = 0;

            if (state.departments.length > 0) {
                state.departments.forEach(d => {
                    totalEmp += d.count;
                    totalMonthlyPayroll += d.total;
                });
                state.data.emp = totalEmp;
                state.data.sal = totalEmp > 0 ? (totalMonthlyPayroll / totalEmp) : 0;
            } else {
                state.data.emp = 0;
                state.data.sal = 0;
            }
            
            document.getElementById('total-employees-display').innerText = totalEmp;
            document.getElementById('avg-salary-display').innerText = formatMoney(state.data.sal);
            document.getElementById('inp-salary').value = state.data.sal.toFixed(2);

            state.data.ben = parseFloat(document.getElementById('inp-benefits').value) || 0;
            state.data.tax = parseFloat(document.getElementById('inp-tax').value);
            state.data.multi = document.getElementById('inp-multisite').checked;
            
            const revStr = document.getElementById('inp-revenue').value.replace(/\./g, '').replace(',', '.');
            state.data.rev = parseFloat(revStr) || 0;

            const monthlyLoad = (state.data.sal * state.data.tax) + state.data.ben;
            const annualPayroll = monthlyLoad * 13.33 * state.data.emp;

            document.getElementById('disp-annual-payroll').innerText = formatMoney(annualPayroll);
            document.getElementById('sidebar-payroll').innerText = formatMoney(annualPayroll);
            document.getElementById('disp-monthly-cost').innerText = formatMoney(monthlyLoad) + "/m√™s";

            state.res.annualPayroll = annualPayroll;
            state.res.monthlyLoad = monthlyLoad;
        }

        // === CORE CALCULATION ENGINE ===
        function runDiagnostics() {
            const D = state.data;
            const R = state.res;
            const QF = CONFIG.QUESTIONS.FIN;
            const QO = CONFIG.QUESTIONS.OPS;
            const AF = state.ans.fin;
            const AO = state.ans.ops;

            const getV = (arr, idx, defIdx) => QF[idx].vals[arr[idx] !== undefined ? arr[idx] : defIdx];
            const getOV = (idx, defIdx) => QO[idx].vals[AO[idx] !== undefined ? AO[idx] : defIdx];

            // --- CALCULATIONS FROM QUESTIONNAIRE ---
            const turnoverRate = getV(AF, 0, 2); 
            const successionFactor = getV(AF, 1, 2);
            // We reduce the weight of generic turnover if we have specific risk data later, but kept for base
            let costTurnover = (D.emp * turnoverRate) * (R.monthlyLoad * 1.5) * successionFactor; 

            const baseAbs = state.ctx === 'AGRO' ? 0.08 : (state.ctx === 'INDUSTRIAL' ? 0.05 : 0.03);
            const absControlMult = getV(AF, 3, 2);
            const costAbs = R.annualPayroll * baseAbs * (absControlMult - 0.5);

            const silenceRate = getV(AF, 6, 2);
            const costSilence = R.annualPayroll * silenceRate;

            const wasteRate = getV(AF, 5, 2);
            const costBlind = (R.annualPayroll * 0.03) * wasteRate;

            const recogRate = getOV(1, 2);
            const leadFactor = getOV(0, 2);
            const costDemotivation = R.annualPayroll * recogRate * leadFactor;

            const healthRate = getOV(2, 2);
            const costHealth = R.annualPayroll * healthRate;

            const newHires = D.emp * turnoverRate;
            const onboardMonths = getOV(3, 2);
            const costOnboard = newHires * (R.monthlyLoad) * (onboardMonths) * 0.5;

            const meetPct = (AO[4] || 25) / 100;
            const costMeet = R.annualPayroll * 0.30 * meetPct;

            const burHours = AO[5] || 4;
            const costBur = (burHours / 40) * R.annualPayroll;

            // --- CALCULATIONS FROM RISK STEP (BACKEND INTEGRATION) ---
            let totalSurgeryCost = 0;
            let totalBleedingCost = 0;
            
            state.departments.forEach(dept => {
                // Determine Cost Per Person for this Dept
                // Logic: (Avg Salary * Tax) + Benefits
                const deptMonthlyLoad = (dept.salary * state.data.tax) + state.data.ben;
                
                // Surgery Cost (Toxic)
                // Logic: Cost to replace = 2.5x Annual Salary (Severance + Hire + Ramp-up)
                // Using 2.5x monthly load * 13.33 approx
                const toxicCount = dept.risk.toxic || 0;
                const costPerToxic = deptMonthlyLoad * 12 * 1.5; // Conservative multiplier for replacement
                totalSurgeryCost += toxicCount * costPerToxic;

                // Bleeding Cost (Contaminated)
                // Logic: 30% inefficiency per year
                const contCount = dept.risk.contaminated || 0;
                const costPerCont = deptMonthlyLoad * 12 * 0.30; 
                totalBleedingCost += contCount * costPerCont;
            });

            // Adjust generic costs if specific risk data is present to avoid double counting
            if(totalSurgeryCost > 0) costTurnover = costTurnover * 0.5; // Reduce generic turnover est
            if(totalBleedingCost > 0) costDemotivation = costDemotivation * 0.2; // Reduce generic demotivation est

            // TOTALS
            const totalTCWL = costTurnover + costAbs + costSilence + costBlind + costDemotivation + costHealth + costOnboard + costMeet + costBur + totalSurgeryCost + totalBleedingCost;
            const recovery = totalTCWL * 0.30;

            // PLAN LOGIC
            let planKey = 'STARTER';
            if (D.emp > 150) planKey = 'GROWTH';
            if (D.emp > 500) planKey = 'ENTERPRISE';
            if (state.ctx === 'INDUSTRIAL' && D.emp > 120) planKey = 'GROWTH';
            if (D.multi && planKey === 'STARTER') planKey = 'GROWTH';
            
            const plan = CONFIG.PLANS[planKey];
            const avgInv = (plan.minPrice + plan.maxPrice) / 2 * 12 * 1000;
            const roi = ((recovery - avgInv) / avgInv) * 100;
            const payback = (avgInv / (recovery/12));

            const hcroi = D.rev > 0 ? (D.rev / R.annualPayroll).toFixed(2) : "0.0";

            const lossPct = totalTCWL / R.annualPayroll;
            const score = Math.max(0, Math.round(100 - (lossPct * 100 * 2)));
            const status = score > 80 ? 'Saud√°vel' : (score > 50 ? 'Alerta' : 'Cr√≠tico');

            // --- RENDER RESULTS ---
            document.getElementById('res-company').innerText = document.getElementById('inp-company').value || 'Sua Empresa';
            document.getElementById('res-score').innerText = score + "/100";
            document.getElementById('res-status').innerText = status;
            document.getElementById('res-status').className = `text-sm font-bold ${score > 80 ? 'text-green-600' : (score > 50 ? 'text-yellow-600' : 'text-red-600')}`;
            
            document.getElementById('res-tcwl').innerText = formatMoney(totalTCWL);
            document.getElementById('res-recovery').innerText = formatMoney(recovery);
            document.getElementById('res-hcroi').innerText = hcroi + "x";
            
            document.getElementById('res-project-roi').innerText = Math.round(roi) + "%";
            document.getElementById('res-payback').innerText = payback.toFixed(1);

            // DILEMMA BOX
            document.getElementById('res-surgery-cost').innerText = formatMoney(totalSurgeryCost);
            document.getElementById('res-bleeding-cost').innerText = formatMoney(totalBleedingCost);
            
            const percentDiff = totalBleedingCost > 0 ? ((totalBleedingCost - totalSurgeryCost) / totalBleedingCost * 100) : 0;
            const insightText = totalBleedingCost > totalSurgeryCost 
                ? `üí° INSIGHT: Manter o problema custa ${Math.abs(percentDiff).toFixed(0)}% a mais do que a solu√ß√£o definitiva (Cirurgia).`
                : `üí° INSIGHT: A solu√ß√£o radical √© mais custosa agora. Foque em recupera√ß√£o (Sangria).`;
            document.getElementById('res-insight-text').innerText = insightText;

            // Plan UI
            document.getElementById('plan-name').innerText = plan.name;
            document.getElementById('plan-desc').innerText = plan.desc;
            document.getElementById('plan-price').innerText = `R$ ${plan.minPrice}k - ${plan.maxPrice}k`;
            document.getElementById('plan-tech').innerHTML = plan.tech.map(t => `<li><i class="fa-solid fa-check text-[#00bcd4] mr-2"></i>${t}</li>`).join('');
            document.getElementById('plan-core').innerHTML = plan.core.map(c => `<li><i class="fa-solid fa-check text-[#00bcd4] mr-2"></i>${c}</li>`).join('');

            // Table
            const rows = [
                { l: 'Risco Cultural (T√≥xicos/Contaminados)', v: totalSurgeryCost + totalBleedingCost },
                { l: 'Turnover & Onboarding (Natural)', v: costTurnover + costOnboard },
                { l: 'Absente√≠smo & Sa√∫de', v: costAbs + costHealth },
                { l: 'Inefici√™ncia (Reuni√µes/Burocracia)', v: costMeet + costBur },
                { l: 'Sil√™ncio & Desmotiva√ß√£o', v: costSilence + costDemotivation }
            ].sort((a,b) => b.v - a.v);

            document.getElementById('table-body').innerHTML = rows.map(r => `
                <tr class="bg-white border-b border-slate-50">
                    <td class="px-4 py-3 font-medium text-slate-900">${r.l}</td>
                    <td class="px-4 py-3 text-right text-slate-600">${formatMoney(r.v)}</td>
                    <td class="px-4 py-3 text-right text-slate-400 text-xs">${((r.v/R.annualPayroll)*100).toFixed(1)}%</td>
                </tr>
            `).join('');

            // Chart
            if(window.myChart) window.myChart.destroy();
            const ctx = document.getElementById('breakdownChart').getContext('2d');
            window.myChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: rows.map(r => r.l),
                    datasets: [{
                        data: rows.map(r => r.v),
                        backgroundColor: ['#ef4444', '#f59e0b', '#10b981', '#3b82f6', '#64748b'],
                        borderWidth: 0
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { boxWidth: 10, font: { size: 10 } } } } }
            });
        }

        // === UTILS ===
        function jumpTo(step) {
            // Validation
            if(step > 0 && !state.ctx) return alert("Selecione um contexto.");
            if(step > 1 && !document.getElementById('inp-company').value) return alert("Preencha o nome da empresa.");
            if(step > 1 && state.departments.length === 0) return alert("Adicione pelo menos um departamento na Estrutura.");
            
            document.querySelector('.step-content.active').classList.remove('active');
            
            const nextStep = document.getElementById(`step-${step}`);
            if(nextStep) {
                nextStep.classList.add('active');
            }

            state.step = step;

            // Trigger Risk Render if entering Step 4 (Index 4 is Step 5 UI)
            if(step === 4) {
                renderRiskStep();
            }
            
            // Progress Bar
            const pct = ((step + 1) / 7) * 100;
            const mobBar = document.getElementById('mobile-progress');
            if(mobBar) mobBar.style.width = pct + "%";
            const mobCount = document.getElementById('mob-step-counter');
            if(mobCount) mobCount.innerText = (step+1) + "/7";
            
            const marker = document.getElementById('progress-marker');
            if(marker) marker.style.transform = `translateY(${step * 24}px)`;
            
            document.querySelectorAll('.step-link').forEach((el, idx) => {
                el.style.opacity = idx === step ? '1' : '0.5';
                el.classList.toggle('text-mfgv-cyan', idx === step);
            });

            // Nav Buttons
            const btnBack = document.querySelector('#nav-footer button:first-child');
            const btnNext = document.querySelector('#nav-footer button:last-child');
            
            btnBack.style.opacity = step === 0 ? '0' : '1';
            btnBack.style.pointerEvents = step === 0 ? 'none' : 'auto';

            if(step === 6) {
                btnNext.innerHTML = '<i class="fa-solid fa-print"></i> Imprimir';
                btnNext.onclick = () => window.print();
            } else {
                btnNext.innerHTML = 'Continuar <i class="fa-solid fa-arrow-right"></i>';
                btnNext.onclick = () => jumpTo(step + 1);
            }

            if(step === 6) runDiagnostics();
        }

        function formatMoney(val) {
            if(val >= 1000000) return "R$ " + (val/1000000).toFixed(1) + "M";
            if(val >= 1000) return "R$ " + (val/1000).toFixed(0) + "k";
            return "R$ " + val.toFixed(0);
        }

        function formatCurrency(input) {
            let v = input.value.replace(/\D/g,'');
            v = (v/100).toFixed(2) + '';
            v = v.replace(".", ",");
            v = v.replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1.");
            input.value = v;
        }

        // Init
        window.addEventListener('load', init);
        
        // Navigation Listeners
        document.querySelector('#nav-footer button:first-child').onclick = () => jumpTo(state.step - 1);
        document.querySelector('#nav-footer button:last-child').onclick = () => jumpTo(state.step + 1);

    </script>
</body>
</html>