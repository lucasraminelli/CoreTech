<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MFGV CoreSight‚Ñ¢ - Diagn√≥stico de Efici√™ncia & Custo de Talento v6.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0066cc;
            --secondary: #ff6b35;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1f2937;
            --light: #f9fafb;
            --border: #e5e7eb;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .steps-container {
            display: flex;
            justify-content: space-between;
            padding: 20px;
            background: #f9fafb;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
            gap: 10px;
        }

        .step-button {
            flex: 1;
            min-width: 120px;
            padding: 12px 20px;
            border: 2px solid var(--border);
            background: white;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
            color: var(--dark);
        }

        .step-button.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .step-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .content {
            padding: 40px;
            min-height: 500px;
        }

        .step {
            display: none;
        }

        .step.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--dark);
            font-size: 0.95em;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 1em;
            transition: border 0.3s;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0,102,204,0.1);
        }

        .radio-group, .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .radio-item, .checkbox-item {
            display: flex;
            align-items: center;
        }

        .radio-item input, .checkbox-item input {
            width: 18px;
            height: 18px;
            margin-right: 10px;
            cursor: pointer;
        }

        .radio-item label, .checkbox-item label {
            margin: 0;
            cursor: pointer;
            font-weight: 500;
        }

        .section-title {
            font-size: 1.3em;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary);
        }

        .info-box {
            background: #e0e7ff;
            border-left: 4px solid var(--primary);
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            font-size: 0.95em;
            color: #1e3a8a;
        }

        /* TABELA DE SETORES */
        .departments-section {
            margin-top: 30px;
            padding: 25px;
            background: #f0f9ff;
            border-radius: 8px;
            border-left: 4px solid var(--secondary);
        }

        .add-department-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background: white;
            border-radius: 6px;
            border: 1px solid var(--border);
        }

        .add-department-form input {
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 0.9em;
        }

        .btn-add-dept {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }

        .btn-add-dept:hover {
            background: #ff5722;
        }

        .departments-table {
            width: 100%;
            margin-top: 15px;
            border-collapse: collapse;
            background: white;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .departments-table th {
            background: var(--primary);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .departments-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border);
        }

        .departments-table tr:hover {
            background: #f0f9ff;
        }

        .btn-delete-dept {
            background: var(--danger);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            transition: background 0.3s;
        }

        .btn-delete-dept:hover {
            background: #dc2626;
        }

        .input-dept-small {
            width: 100%;
            padding: 6px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 0.9em;
        }

        /* BOT√ïES */
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: space-between;
        }

        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 6px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #0052a3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,102,204,0.3);
        }

        .btn-secondary {
            background: var(--border);
            color: var(--dark);
        }

        .btn-secondary:hover {
            background: #d1d5db;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        /* DASHBOARD / RESULTADOS */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .card-label {
            font-size: 0.85em;
            color: #6b7280;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .card-value {
            font-size: 2em;
            font-weight: 700;
            color: var(--primary);
        }

        .card-secondary {
            font-size: 0.9em;
            color: #6b7280;
            margin-top: 8px;
        }

        .risk-card {
            border-left: 4px solid var(--danger);
            background: #fef2f2;
        }

        .risk-card .card-value {
            color: var(--danger);
        }

        .decision-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        .decision-box h3 {
            font-size: 1.3em;
            margin-bottom: 15px;
        }

        .decision-box p {
            font-size: 1em;
            line-height: 1.6;
            opacity: 0.95;
        }

        .plan-card {
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .plan-card.recommended {
            border-color: var(--success);
            background: #f0fdf4;
            box-shadow: 0 8px 20px rgba(16,185,129,0.2);
        }

        .plan-card h3 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .plan-badge {
            display: inline-block;
            background: var(--success);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .plan-price {
            font-size: 1.8em;
            color: var(--success);
            font-weight: 700;
            margin: 15px 0;
        }

        .plan-list {
            list-style: none;
            margin: 15px 0;
        }

        .plan-list li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }

        .plan-list li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: var(--success);
            font-weight: 700;
        }

        .table-responsive {
            overflow-x: auto;
            margin: 20px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border: 1px solid var(--border);
            border-radius: 6px;
            overflow: hidden;
        }

        thead {
            background: var(--dark);
            color: white;
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border);
        }

        tbody tr:hover {
            background: #f9fafb;
        }

        .text-muted {
            color: #6b7280;
            font-size: 0.9em;
        }

        .text-success {
            color: var(--success);
            font-weight: 600;
        }

        .text-danger {
            color: var(--danger);
            font-weight: 600;
        }

        .text-warning {
            color: var(--warning);
            font-weight: 600;
        }

        .footer {
            background: var(--dark);
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 0.9em;
        }

        .hidden {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid var(--border);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsivo */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .steps-container {
                flex-direction: column;
            }

            .step-button {
                min-width: auto;
            }

            .content {
                padding: 20px;
            }

            .dashboard {
                grid-template-columns: 1fr;
            }

            .add-department-form {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ MFGV CoreSight‚Ñ¢</h1>
            <p>Diagn√≥stico de Efici√™ncia & Custo de Talento | v6.0 Definitive</p>
        </div>

        <div class="steps-container">
            <button class="step-button active" onclick="showStep(1)">Step 1: Contexto</button>
            <button class="step-button" onclick="showStep(2)">Step 2: Estrutura</button>
            <button class="step-button" onclick="showStep(3)">Step 3: Financeiro</button>
            <button class="step-button" onclick="showStep(4)">Step 4: Risco</button>
            <button class="step-button" onclick="showStep(5)">Step 5: Dashboard</button>
        </div>

        <div class="content">
            <!-- STEP 1: CONTEXTO -->
            <div class="step active" id="step1">
                <h2 class="section-title">Step 1: Qual o perfil da opera√ß√£o?</h2>
                <p style="color: #6b7280; margin-bottom: 20px;">Isso define os benchmarks de risco, produtividade e mapeamento de setores.</p>

                <div class="form-group">
                    <label>Perfil da Opera√ß√£o</label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" id="profile_agro" name="operationProfile" value="Agroneg√≥cio">
                            <label for="profile_agro">üåæ Agroneg√≥cio</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="profile_industrial" name="operationProfile" value="Industrial">
                            <label for="profile_industrial">‚öôÔ∏è Industrial</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="profile_corporate" name="operationProfile" value="Corporate">
                            <label for="profile_corporate">üè¢ Corporate</label>
                        </div>
                    </div>
                </div>

                <div class="info-box">
                    <strong>üí° Dica:</strong> O perfil escolhido define benchmarks de produtividade, risco e estrutura organizacional.
                </div>

                <div class="form-group">
                    <label>Nome da Empresa</label>
                    <input type="text" id="companyName" placeholder="Ex: XYZ Ind√∫stria Ltda">
                </div>

                <div class="form-group">
                    <label>Qual seu maior desafio atual?</label>
                    <textarea id="challenge" rows="4" placeholder="Ex: Turnover alto em opera√ß√£o, falta de engajamento, comunica√ß√£o ruim..."></textarea>
                </div>

                <div class="form-group">
                    <label>Como est√° sua lideran√ßa?</label>
                    <select id="leadership">
                        <option value="">Selecione...</option>
                        <option value="Muito Forte">Muito Forte</option>
                        <option value="Forte">Forte</option>
                        <option value="Moderada">Moderada</option>
                        <option value="Fraca">Fraca</option>
                        <option value="Muito Fraca">Muito Fraca</option>
                    </select>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="saveStep1(); showStep(2)">Pr√≥ximo ‚Üí</button>
                </div>
            </div>

            <!-- STEP 2: ESTRUTURA -->
            <div class="step" id="step2">
                <h2 class="section-title">Step 2: Estrutura Organizacional</h2>
                <p style="color: #6b7280; margin-bottom: 20px;">Defina setores, colaboradores e remunera√ß√£o. Inicie em "Contexto" para carregar op√ß√µes.</p>

                <div class="form-group">
                    <label>Total de Colaboradores</label>
                    <input type="number" id="totalEmployees" placeholder="Ex: 150" min="1">
                </div>

                <div class="form-group">
                    <label>Faixa de Colaboradores</label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" id="size_10" name="employeeSize" value="10-99" onclick="updateDepartmentSuggestions()">
                            <label for="size_10">10-99</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="size_500" name="employeeSize" value="100-500" onclick="updateDepartmentSuggestions()">
                            <label for="size_500">100-500</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="size_2000" name="employeeSize" value="500-2000" onclick="updateDepartmentSuggestions()">
                            <label for="size_2000">500-2000</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="size_plus" name="employeeSize" value="2000+" onclick="updateDepartmentSuggestions()">
                            <label for="size_plus">2000+</label>
                        </div>
                    </div>
                </div>

                <div class="info-box">
                    <strong>üìä Mapeamento de Departamentos:</strong> Adicione os setores/departamentos da sua empresa. Voc√™ especificar√° risco e problemas de pessoal por setor na pr√≥xima etapa.
                </div>

                <!-- M√ìDULO DE DEPARTAMENTOS INJETADO -->
                <div class="departments-section">
                    <h3 style="margin-bottom: 15px; color: var(--secondary);">üìç Mapeamento de Departamentos</h3>
                    
                    <div class="add-department-form">
                        <input type="text" id="deptName" placeholder="Nome do Departamento (ex: Opera√ß√£o, TI, RH)">
                        <input type="number" id="deptEmployees" placeholder="N¬∫ de Colaboradores" min="1">
                        <input type="number" id="deptAvgSalary" placeholder="Sal√°rio M√©dio Mensal (R$)" min="0">
                        <button class="btn-add-dept" onclick="addDepartment()">+ Adicionar Setor</button>
                    </div>

                    <table class="departments-table" id="departmentsTable">
                        <thead>
                            <tr>
                                <th>Departamento</th>
                                <th>Colaboradores</th>
                                <th>Sal√°rio M√©dio</th>
                                <th>Folha Mensal</th>
                                <th>A√ß√£o</th>
                            </tr>
                        </thead>
                        <tbody id="departmentsBody">
                        </tbody>
                    </table>
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="showStep(1)">‚Üê Anterior</button>
                    <button class="btn btn-primary" onclick="saveStep2(); showStep(3)">Pr√≥ximo ‚Üí</button>
                </div>
            </div>

            <!-- STEP 3: FINANCEIRO -->
            <div class="step" id="step3">
                <h2 class="section-title">Step 3: Auditoria Financeira</h2>
                <p style="color: #6b7280; margin-bottom: 20px;">Configure o regime tribut√°rio e benef√≠cios globais.</p>

                <div class="form-group">
                    <label>Custo Total Folha (Anual)</label>
                    <input type="number" id="totalPayroll" placeholder="R$ 0,00" min="0" step="0.01">
                </div>

                <div class="info-box">
                    <strong>üí° C√°lculo Autom√°tico:</strong> Multiplicador CLT padr√£o 1.40x (inclui 13¬∫, f√©rias, encargos e benef√≠cios).
                </div>

                <div class="form-group">
                    <label>Regime Tribut√°rio</label>
                    <select id="taxRegime">
                        <option value="">Selecione...</option>
                        <option value="Simples">Simples Nacional</option>
                        <option value="Lucro Real">Lucro Real</option>
                        <option value="Lucro Presumido">Lucro Presumido</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Multiplicador CLT (padr√£o: 1.40x)</label>
                    <input type="number" id="cltMultiplier" value="1.40" step="0.01" min="1">
                </div>

                <div class="form-group">
                    <label>Vale Refei√ß√£o, Sa√∫de, Transporte, etc. (R$ por colaborador/m√™s)</label>
                    <input type="number" id="benefits" placeholder="0" min="0" step="0.01">
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="showStep(2)">‚Üê Anterior</button>
                    <button class="btn btn-primary" onclick="saveStep3(); showStep(4)">Pr√≥ximo ‚Üí</button>
                </div>
            </div>

            <!-- STEP 4: RISCO -->
            <div class="step" id="step4">
                <h2 class="section-title">Step 4: An√°lise de Comportamento por Setor</h2>
                <p style="color: #6b7280; margin-bottom: 20px;">Quantifique colaboradores t√≥xicos e contaminados em cada departamento.</p>

                <div id="riskCardsContainer"></div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="showStep(3)">‚Üê Anterior</button>
                    <button class="btn btn-primary" onclick="saveStep4(); showStep(5)">Ver Diagn√≥stico ‚Üí</button>
                </div>
            </div>

            <!-- STEP 5: DASHBOARD / RESULTADOS -->
            <div class="step" id="step5">
                <h2 class="section-title">Step 5: Diagn√≥stico Executivo</h2>

                <div id="loadingDiagnosis" class="loading">
                    <div class="spinner"></div>
                    <p>Analisando dados e gerando diagn√≥stico...</p>
                </div>

                <div id="diagnosisResults" class="hidden">
                    <!-- DECIS√ÉO EXECUTIVA -->
                    <div class="decision-box">
                        <h3>üìä Relat√≥rio de Efici√™ncia</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-top: 25px;">
                            <div>
                                <div style="font-size: 2em; font-weight: 700;">
                                    <span id="healthScore">0</span>/100
                                </div>
                                <div style="font-size: 0.85em; opacity: 0.9;">Score de Sa√∫de</div>
                            </div>
                            <div>
                                <div style="font-size: 1.8em; font-weight: 700;">
                                    <span id="annualLoss">R$ 0</span>
                                </div>
                                <div style="font-size: 0.85em; opacity: 0.9;">Perda Anual (TCWL)</div>
                            </div>
                            <div>
                                <div style="font-size: 1.8em; font-weight: 700;">
                                    <span id="recoveryPotential">R$ 0</span>
                                </div>
                                <div style="font-size: 0.85em; opacity: 0.9;">Potencial Recupera√ß√£o</div>
                            </div>
                            <div>
                                <div style="font-size: 1.8em; font-weight: 700;">
                                    <span id="roiValue">0.0x</span>
                                </div>
                                <div style="font-size: 0.85em; opacity: 0.9;">HC ROI Atual</div>
                            </div>
                        </div>
                    </div>

                    <!-- O DILEMA: CIRURGIA VS SANGRIA -->
                    <div style="margin-top: 30px;">
                        <h3 style="color: var(--primary); margin-bottom: 20px;">üíâ O Dilema: Resolver vs. Ignorar</h3>
                        <div class="dashboard">
                            <div class="card">
                                <div class="card-label">üíâ Cirurgia (Sa√≠da)</div>
                                <div class="card-value" id="surgeryCost">R$ 0</div>
                                <div class="card-secondary">Rescis√£o, recrutamento e treinamento de 3 meses.</div>
                            </div>
                            <div class="card risk-card">
                                <div class="card-label">ü©∏ Sangria (Perda)</div>
                                <div class="card-value" id="bleedingCost">R$ 0</div>
                                <div class="card-secondary">Sal√°rio pago sem retorno + inefici√™ncia anual.</div>
                            </div>
                        </div>
                        <div class="decision-box" style="margin-top: 20px;">
                            <p id="insightText" style="font-size: 1.05em;"></p>
                        </div>
                    </div>

                    <!-- COMPOSI√á√ÉO DE PERDAS POR SETOR -->
                    <div style="margin-top: 30px;">
                        <h3 style="color: var(--primary); margin-bottom: 20px;">üìà Composi√ß√£o das Perdas por Setor</h3>
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Setor</th>
                                        <th>Colaboradores</th>
                                        <th>T√≥xicos</th>
                                        <th>Contaminados</th>
                                        <th>Custo Cirurgia</th>
                                        <th>Custo Sangria</th>
                                        <th>Total Anual</th>
                                    </tr>
                                </thead>
                                <tbody id="sectorCompositionTable">
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- DETALHAMENTO DE CUSTOS OCULTOS -->
                    <div style="margin-top: 30px;">
                        <h3 style="color: var(--primary); margin-bottom: 20px;">üîç Detalhamento dos Custos Ocultos</h3>
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Fonte de Perda</th>
                                        <th>Impacto Anual</th>
                                        <th>% Folha</th>
                                    </tr>
                                </thead>
                                <tbody id="costBreakdownTable">
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- PLANOS RECOMENDADOS -->
                    <div style="margin-top: 40px;">
                        <h3 style="color: var(--primary); margin-bottom: 20px;">üéØ Plano Recomendado 2026</h3>
                        <div id="plansContainer"></div>
                    </div>

                    <!-- A√á√ïES RECOMENDADAS -->
                    <div style="margin-top: 40px; padding: 25px; background: #f0fdf4; border-radius: 8px; border-left: 4px solid var(--success);">
                        <h3 style="color: var(--success); margin-bottom: 15px;">‚úÖ Pr√≥ximos Passos</h3>
                        <div id="actionItems"></div>
                    </div>
                </div>

                <div class="button-group" style="margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="showStep(4)">‚Üê Voltar</button>
                    <button class="btn btn-primary" onclick="printDiagnosis()">üìÑ Exportar PDF</button>
                    <button class="btn btn-success" onclick="resetForm()">üîÑ Novo Diagn√≥stico</button>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>MFGV CoreSight v6.0 ‚Ä¢ Algoritmo Audit√°vel ‚Ä¢ Baseado em Benchmark Brasil 2025</p>
        </div>
    </div>

    <script>
        // ============================================================
        // DADOS GLOBAIS
        // ============================================================
        const data = {
            step1: {},
            step2: { departments: [] },
            step3: {},
            step4: {},
            diagnosis: {}
        };

        // Benchmarks por perfil
        const benchmarks = {
            'Agroneg√≥cio': { toxicRate: 0.15, contaminatedRate: 0.25, efficiency: 0.75 },
            'Industrial': { toxicRate: 0.12, contaminatedRate: 0.20, efficiency: 0.80 },
            'Corporate': { toxicRate: 0.10, contaminatedRate: 0.15, efficiency: 0.85 }
        };

        // Servi√ßos mapeados do cat√°logo
        const servicesCatalog = {
            'CORE-HUMAN': {
                name: 'Core Human',
                description: 'Plataforma de engajamento, clima e sa√∫de mental em tempo real',
                cost: 15000
            },
            'CORE-FLOW': {
                name: 'Core Flow',
                description: 'Plataforma de efici√™ncia operacional e fluxos de trabalho',
                cost: 18000
            },
            'STRATEGY-HUB': {
                name: 'Strategy Hub',
                description: 'Sala de controle que conecta dados de pessoas e processos',
                cost: 25000
            },
            'DIAGNOSTICO': {
                name: 'Diagn√≥stico',
                description: 'An√°lise profunda de 2-10 dias com recomenda√ß√µes',
                cost: 12000
            },
            'LIDERANCA': {
                name: 'Lideran√ßa & Desenvolvimento',
                description: 'Treinamento comportamental para l√≠deres',
                cost: 8000
            },
            'DEEPWORK': {
                name: 'Protocolo DeepWork',
                description: 'Framework para eliminar reuni√µes improdutivas',
                cost: 5000
            },
            'RETENCAO': {
                name: 'Reten√ß√£o de Talentos',
                description: 'Estrutura completa para reter pessoas certas',
                cost: 10000
            },
            'SUCESSAO': {
                name: 'Programa de Sucess√£o',
                description: 'Prepara√ß√£o de sucessores para postos-chave',
                cost: 15000
            },
            'STACK': {
                name: 'Auditoria Stack + Automa√ß√£o',
                description: 'An√°lise e elimina√ß√£o de sistemas desconectados',
                cost: 20000
            },
            'PSICOLOGICA': {
                name: 'Seguran√ßa Psicol√≥gica',
                description: 'Programa que transforma medo em confian√ßa',
                cost: 7000
            },
            'COMUNICACAO': {
                name: 'Comunica√ß√£o Integrada',
                description: 'Sistema estruturado de comunica√ß√£o interna',
                cost: 9000
            },
            'RECONHECIMENTO': {
                name: 'Reconhecimento em Tempo Real',
                description: 'Sistema de reconhecimento e premia√ß√£o',
                cost: 6000
            },
            'TCWL': {
                name: 'An√°lise TCWL',
                description: 'C√°lculo exato do custo de sa√≠da de colaborador',
                cost: 8000
            },
            'ONA': {
                name: 'Organizational Network Analysis',
                description: 'Mapa de relacionamentos e depend√™ncias cr√≠ticas',
                cost: 12000
            },
            'EAP': {
                name: 'Bem-Estar + Sa√∫de Mental',
                description: 'Programa completo de sa√∫de mental e bem-estar',
                cost: 11000
            }
        };

        // Planos Starter, Growth, Enterprise
        const plans = {
            'Starter': {
                name: 'Starter',
                price: 45000,
                duration: '6 meses',
                minAnnualPayroll: 0,
                maxAnnualPayroll: 2000000,
                services: ['DIAGNOSTICO', 'LIDERANCA', 'DEEPWORK'],
                description: 'Perfeito para empresas em crescimento que precisam diagnosticar problemas e fortalecer lideran√ßa.'
            },
            'Growth': {
                name: 'Growth',
                price: 95000,
                duration: '12 meses',
                minAnnualPayroll: 2000000,
                maxAnnualPayroll: 10000000,
                services: ['DIAGNOSTICO', 'CORE-HUMAN', 'CORE-FLOW', 'LIDERANCA', 'DEEPWORK', 'RETENCAO'],
                description: 'Para empresas em expans√£o que precisam conectar dados de pessoas e processos com estrat√©gia clara.'
            },
            'Enterprise': {
                name: 'Enterprise',
                price: 180000,
                duration: '18 meses',
                minAnnualPayroll: 10000000,
                maxAnnualPayroll: Infinity,
                services: ['DIAGNOSTICO', 'CORE-HUMAN', 'CORE-FLOW', 'STRATEGY-HUB', 'LIDERANCA', 'DEEPWORK', 'RETENCAO', 'SUCESSAO', 'STACK', 'PSICOLOGICA', 'COMUNICACAO', 'RECONHECIMENTO', 'TCWL', 'ONA', 'EAP'],
                description: 'Solu√ß√£o completa para transforma√ß√£o organizacional com todas as ferramentas integradas.'
            }
        };

        // ============================================================
        // FUN√á√ÉO PRINCIPAL: MOSTRAR STEP
        // ============================================================
        function showStep(stepNumber) {
            // Ocultar todos os steps
            document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.step-button').forEach(el => el.classList.remove('active'));

            // Mostrar step selecionado
            document.getElementById(`step${stepNumber}`).classList.add('active');
            document.querySelectorAll('.step-button')[stepNumber - 1].classList.add('active');

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // Se Step 4, renderizar cards de risco
            if (stepNumber === 4) {
                renderRiskCards();
            }

            // Se Step 5, gerar diagn√≥stico
            if (stepNumber === 5) {
                generateDiagnosis();
            }
        }

        // ============================================================
        // STEP 1: CONTEXTO
        // ============================================================
        function saveStep1() {
            data.step1 = {
                operationProfile: document.getElementById('operationProfile').value || document.querySelector('input[name="operationProfile"]:checked')?.value || '',
                companyName: document.getElementById('companyName').value || 'Empresa',
                challenge: document.getElementById('challenge').value || '',
                leadership: document.getElementById('leadership').value || ''
            };

            if (!data.step1.operationProfile) {
                alert('‚ö†Ô∏è Por favor, selecione o perfil da opera√ß√£o.');
                return false;
            }
        }

        function getOperationProfile() {
            return document.querySelector('input[name="operationProfile"]:checked')?.value || 'Corporate';
        }

        // ============================================================
        // STEP 2: ESTRUTURA E DEPARTAMENTOS
        // ============================================================
        function updateDepartmentSuggestions() {
            // Placeholder para l√≥gica de sugest√µes
        }

        function addDepartment() {
            const name = document.getElementById('deptName').value.trim();
            const employees = parseInt(document.getElementById('deptEmployees').value) || 0;
            const avgSalary = parseFloat(document.getElementById('deptAvgSalary').value) || 0;

            if (!name || employees <= 0) {
                alert('‚ö†Ô∏è Preencha o nome e n√∫mero de colaboradores.');
                return;
            }

            const department = {
                id: Date.now(),
                name: name,
                employees: employees,
                avgSalary: avgSalary,
                monthlyPayroll: employees * avgSalary
            };

            data.step2.departments.push(department);
            renderDepartmentsTable();
            clearDepartmentForm();
        }

        function renderDepartmentsTable() {
            const tbody = document.getElementById('departmentsBody');
            tbody.innerHTML = '';

            data.step2.departments.forEach(dept => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${dept.name}</td>
                    <td>${dept.employees}</td>
                    <td>R$ ${dept.avgSalary.toFixed(2)}</td>
                    <td>R$ ${dept.monthlyPayroll.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                    <td><button class="btn-delete-dept" onclick="deleteDepartment(${dept.id})">Remover</button></td>
                `;
            });
        }

        function deleteDepartment(id) {
            data.step2.departments = data.step2.departments.filter(d => d.id !== id);
            renderDepartmentsTable();
        }

        function clearDepartmentForm() {
            document.getElementById('deptName').value = '';
            document.getElementById('deptEmployees').value = '';
            document.getElementById('deptAvgSalary').value = '';
        }

        function saveStep2() {
            data.step2.totalEmployees = parseInt(document.getElementById('totalEmployees').value) || 0;
            data.step2.employeeSize = document.querySelector('input[name="employeeSize"]:checked')?.value || '';

            if (data.step2.departments.length === 0) {
                alert('‚ö†Ô∏è Adicione pelo menos um departamento.');
                return false;
            }

            return true;
        }

        // ============================================================
        // STEP 3: FINANCEIRO
        // ============================================================
        function saveStep3() {
            data.step3 = {
                totalPayroll: parseFloat(document.getElementById('totalPayroll').value) || 0,
                taxRegime: document.getElementById('taxRegime').value || 'Lucro Real',
                cltMultiplier: parseFloat(document.getElementById('cltMultiplier').value) || 1.40,
                benefits: parseFloat(document.getElementById('benefits').value) || 0
            };

            if (data.step3.totalPayroll === 0) {
                alert('‚ö†Ô∏è Informe o custo total da folha de pagamento.');
                return false;
            }

            return true;
        }

        // ============================================================
        // STEP 4: RISCO POR SETOR
        // ============================================================
        function renderRiskCards() {
            const container = document.getElementById('riskCardsContainer');
            container.innerHTML = '';

            data.step2.departments.forEach(dept => {
                const card = document.createElement('div');
                card.className = 'card';
                card.style.marginBottom = '20px';
                card.style.borderLeft = '4px solid var(--warning)';
                card.innerHTML = `
                    <h4 style="color: var(--primary); margin-bottom: 15px;">${dept.name}</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        <div>
                            <label style="font-weight: 600; color: #6b7280; font-size: 0.85em;">Colaboradores T√≥xicos</label>
                            <input type="number" id="toxic_${dept.id}" min="0" max="${dept.employees}" placeholder="0" style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid var(--border); border-radius: 4px;">
                        </div>
                        <div>
                            <label style="font-weight: 600; color: #6b7280; font-size: 0.85em;">Colaboradores Contaminados</label>
                            <input type="number" id="contaminated_${dept.id}" min="0" max="${dept.employees}" placeholder="0" style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid var(--border); border-radius: 4px;">
                        </div>
                    </div>
                    <p style="margin-top: 10px; font-size: 0.85em; color: #6b7280;">Total de colaboradores: <strong>${dept.employees}</strong></p>
                `;
                container.appendChild(card);
            });
        }

        function saveStep4() {
            data.step4 = {};
            data.step2.departments.forEach(dept => {
                const toxic = parseInt(document.getElementById(`toxic_${dept.id}`).value) || 0;
                const contaminated = parseInt(document.getElementById(`contaminated_${dept.id}`).value) || 0;

                data.step4[dept.id] = {
                    name: dept.name,
                    employees: dept.employees,
                    avgSalary: dept.avgSalary,
                    toxic: toxic,
                    contaminated: contaminated
                };
            });

            return true;
        }

        // ============================================================
        // DIAGN√ìSTICO: C√ÅLCULOS MATEM√ÅTICOS
        // ============================================================
        function generateDiagnosis() {
            document.getElementById('diagnosisResults').classList.add('hidden');
            document.getElementById('loadingDiagnosis').classList.remove('hidden');

            // Simular carregamento
            setTimeout(() => {
                calculateDiagnosis();
                document.getElementById('loadingDiagnosis').classList.add('hidden');
                document.getElementById('diagnosisResults').classList.remove('hidden');
            }, 1500);
        }

        function calculateDiagnosis() {
            const profile = getOperationProfile();
            const benchmark = benchmarks[profile] || benchmarks['Corporate'];

            let totalToxic = 0;
            let totalContaminated = 0;
            let totalEmployees = 0;
            let totalAnnualPayroll = 0;
            let sectorData = [];

            // Coleta dados dos setores
            data.step2.departments.forEach(dept => {
                const riskData = data.step4[dept.id];
                const toxic = riskData.toxic;
                const contaminated = riskData.contaminated;
                
                totalToxic += toxic;
                totalContaminated += contaminated;
                totalEmployees += dept.employees;

                const annualPayroll = dept.employees * dept.avgSalary * 12 * data.step3.cltMultiplier;
                totalAnnualPayroll += annualPayroll;

                // C√°lculos por setor
                const surgeryPerToxic = (dept.avgSalary * 12 * data.step3.cltMultiplier * 2.5); // 2.5x do sal√°rio anual
                const surgeryCost = toxic * surgeryPerToxic;
                
                const bleedingPerToxic = dept.avgSalary * 12 * data.step3.cltMultiplier * 0.3; // 30% de inefici√™ncia anual
                const bleedingCost = (toxic + contaminated * 0.5) * bleedingPerToxic;

                sectorData.push({
                    name: dept.name,
                    employees: dept.employees,
                    toxic: toxic,
                    contaminated: contaminated,
                    surgeryPerPerson: surgeryPerToxic,
                    surgeryCost: surgeryCost,
                    bleedingPerPerson: bleedingPerToxic,
                    bleedingCost: bleedingCost,
                    totalCost: surgeryCost + bleedingCost
                });
            });

            // C√°lculos globais
            const totalSurgeryCost = sectorData.reduce((sum, s) => sum + s.surgeryCost, 0);
            const totalBleedingCost = sectorData.reduce((sum, s) => sum + s.bleedingCost, 0);
            const totalAnnualLoss = totalSurgeryCost + totalBleedingCost;

            const healthScore = Math.max(0, Math.min(100, 100 - (totalToxic / totalEmployees * 100 * 0.5) - (totalContaminated / totalEmployees * 100 * 0.25)));

            const recoveryPotential = totalAnnualLoss * 0.35; // 35% de recupera√ß√£o potencial
            const hcRoi = totalAnnualPayroll > 0 ? (recoveryPotential / totalAnnualPayroll) : 0;

            // Armazenar diagn√≥stico
            data.diagnosis = {
                profile: profile,
                totalEmployees: totalEmployees,
                totalToxic: totalToxic,
                totalContaminated: totalContaminated,
                totalAnnualPayroll: totalAnnualPayroll,
                healthScore: Math.round(healthScore),
                surgeryCost: totalSurgeryCost,
                bleedingCost: totalBleedingCost,
                annualLoss: totalAnnualLoss,
                recoveryPotential: recoveryPotential,
                hcRoi: hcRoi,
                sectorData: sectorData
            };

            // Renderizar resultados
            renderDiagnosisResults();
        }

        function renderDiagnosisResults() {
            const d = data.diagnosis;

            // Valores principais
            document.getElementById('healthScore').textContent = d.healthScore;
            document.getElementById('annualLoss').textContent = `R$ ${d.annualLoss.toLocaleString('pt-BR', {maximumFractionDigits: 0})}`;
            document.getElementById('recoveryPotential').textContent = `R$ ${d.recoveryPotential.toLocaleString('pt-BR', {maximumFractionDigits: 0})}`;
            document.getElementById('roiValue').textContent = (d.hcRoi * 100).toFixed(1) + '%';

            // Cirurgia vs Sangria
            document.getElementById('surgeryCost').textContent = `R$ ${d.surgeryCost.toLocaleString('pt-BR', {maximumFractionDigits: 0})}`;
            document.getElementById('bleedingCost').textContent = `R$ ${d.bleedingCost.toLocaleString('pt-BR', {maximumFractionDigits: 0})}`;

            const percentDiff = d.bleedingCost > 0 ? ((d.bleedingCost - d.surgeryCost) / d.bleedingCost * 100) : 0;
            const insightText = d.bleedingCost > d.surgeryCost 
                ? `üí° INSIGHT MFGV: Manter o problema custa ${Math.abs(percentDiff).toFixed(0)}% a mais do que a solu√ß√£o definitiva.`
                : `üí° INSIGHT MFGV: A solu√ß√£o √© ${Math.abs(percentDiff).toFixed(0)}% mais cara que manter o status quo (considere os riscos ocultos).`;
            document.getElementById('insightText').textContent = insightText;

            // Tabela de composi√ß√£o por setor
            renderSectorComposition();

            // Tabela de custos ocultos
            renderCostBreakdown();

            // Recomenda√ß√£o de plano
            recommendPlan();

            // A√ß√µes recomendadas
            renderActionItems();
        }

        function renderSectorComposition() {
            const tbody = document.getElementById('sectorCompositionTable');
            tbody.innerHTML = '';

            data.diagnosis.sectorData.forEach(sector => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><strong>${sector.name}</strong></td>
                    <td>${sector.employees}</td>
                    <td><span class="text-danger">${sector.toxic}</span></td>
                    <td><span class="text-warning">${sector.contaminated}</span></td>
                    <td>R$ ${sector.surgeryCost.toLocaleString('pt-BR', {maximumFractionDigits: 0})}</td>
                    <td>R$ ${sector.bleedingCost.toLocaleString('pt-BR', {maximumFractionDigits: 0})}</td>
                    <td><strong>R$ ${sector.totalCost.toLocaleString('pt-BR', {maximumFractionDigits: 0})}</strong></td>
                `;
            });
        }

        function renderCostBreakdown() {
            const tbody = document.getElementById('costBreakdownTable');
            tbody.innerHTML = '';

            const costs = [
                {
                    name: 'Turnover (T√≥xicos)',
                    amount: data.diagnosis.surgeryCost,
                    percentage: (data.diagnosis.surgeryCost / data.diagnosis.annualLoss * 100).toFixed(1)
                },
                {
                    name: 'Inefici√™ncia Operacional',
                    amount: data.diagnosis.bleedingCost * 0.6,
                    percentage: (data.diagnosis.bleedingCost * 0.6 / data.diagnosis.annualLoss * 100).toFixed(1)
                },
                {
                    name: 'Absente√≠smo e Sa√∫de',
                    amount: data.diagnosis.bleedingCost * 0.25,
                    percentage: (data.diagnosis.bleedingCost * 0.25 / data.diagnosis.annualLoss * 100).toFixed(1)
                },
                {
                    name: 'Retrabalho e Erros',
                    amount: data.diagnosis.bleedingCost * 0.15,
                    percentage: (data.diagnosis.bleedingCost * 0.15 / data.diagnosis.annualLoss * 100).toFixed(1)
                }
            ];

            costs.forEach(cost => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><strong>${cost.name}</strong></td>
                    <td>R$ ${cost.amount.toLocaleString('pt-BR', {maximumFractionDigits: 0})}</td>
                    <td><strong>${cost.percentage}%</strong></td>
                `;
            });
        }

        function recommendPlan() {
            let recommendedPlan = 'Starter';
            const annualPayroll = data.diagnosis.totalAnnualPayroll;

            if (annualPayroll >= 10000000) {
                recommendedPlan = 'Enterprise';
            } else if (annualPayroll >= 2000000) {
                recommendedPlan = 'Growth';
            }

            const container = document.getElementById('plansContainer');
            container.innerHTML = '';

            Object.keys(plans).forEach(planKey => {
                const plan = plans[planKey];
                const isRecommended = planKey === recommendedPlan;

                const planCard = document.createElement('div');
                planCard.className = `plan-card ${isRecommended ? 'recommended' : ''}`;

                let servicesHtml = '<ul class="plan-list">';
                plan.services.forEach(serviceKey => {
                    const service = servicesCatalog[serviceKey];
                    if (service) {
                        servicesHtml += `<li>${service.name}: ${service.description}</li>`;
                    }
                });
                servicesHtml += '</ul>';

                planCard.innerHTML = `
                    ${isRecommended ? '<div class="plan-badge">‚úì RECOMENDADO</div>' : ''}
                    <h3>${plan.name}</h3>
                    <p style="color: #6b7280; margin-bottom: 15px;">${plan.description}</p>
                    <div class="plan-price">R$ ${plan.price.toLocaleString('pt-BR')}</div>
                    <p style="color: #6b7280; font-size: 0.9em; margin-bottom: 15px;">Contrato: ${plan.duration}</p>
                    <div style="margin-bottom: 15px;">
                        <strong style="color: var(--primary);">Servi√ßos Inclusos:</strong>
                        ${servicesHtml}
                    </div>
                    <p style="color: #6b7280; font-size: 0.85em; margin-top: 15px;">
                        <strong>ROI Estimado:</strong> ${((plan.price * 3) / plan.price).toFixed(1)}x em 18 meses
                    </p>
                    <button class="btn btn-success" style="width: 100%; margin-top: 15px;" onclick="selectPlan('${planKey}')">
                        Solicitar Proposta
                    </button>
                `;

                container.appendChild(planCard);
            });
        }

        function selectPlan(planName) {
            alert(`‚úÖ Voc√™ selecionou o plano ${planName}!\n\nEm breve um consultor MFGV entrar√° em contato para detalhar a proposta.`);
        }

        function renderActionItems() {
            const container = document.getElementById('actionItems');
            const healthScore = data.diagnosis.healthScore;

            let actions = [];

            if (data.diagnosis.totalToxic > 0) {
                actions.push(`üéØ <strong>Risco Cr√≠tico:</strong> Identificar e remanejar ${data.diagnosis.totalToxic} colaborador(es) t√≥xico(s) que somam R$ ${data.diagnosis.surgeryCost.toLocaleString('pt-BR', {maximumFractionDigits: 0})} em custo de sa√≠da.`);
            }

            if (data.diagnosis.totalContaminated > 0) {
                actions.push(`‚ö†Ô∏è <strong>A√ß√£o Preventiva:</strong> Implementar programa de reten√ß√£o e desenvolvimento para ${data.diagnosis.totalContaminated} colaborador(es) contaminado(s) antes que se tornem t√≥xicos.`);
            }

            if (healthScore < 40) {
                actions.push(`üî¥ <strong>Urgente:</strong> Score de sa√∫de cr√≠tico (${healthScore}/100). Recomenda-se diagn√≥stico completo e interven√ß√£o imediata de lideran√ßa e comunica√ß√£o.`);
            } else if (healthScore < 60) {
                actions.push(`üü° <strong>Moderado:</strong> Score de sa√∫de abaixo do esperado (${healthScore}/100). Investir em lideran√ßa, comunica√ß√£o e bem-estar do time.`);
            }

            actions.push(`üí∞ <strong>Recupera√ß√£o Financeira:</strong> Potencial de recupera√ß√£o de R$ ${data.diagnosis.recoveryPotential.toLocaleString('pt-BR', {maximumFractionDigits: 0})} em 12 meses com investimento em plano recomendado.`);

            actions.push(`üìä <strong>Pr√≥ximo Passo:</strong> Agendar reuni√£o com equipe MFGV para revisar diagn√≥stico detalhado por setor e customizar plano de a√ß√£o.`);

            let html = '<ul style="list-style: none; padding: 0;">';
            actions.forEach(action => {
                html += `<li style="padding: 12px 0; border-bottom: 1px solid rgba(0,0,0,0.05);">${action}</li>`;
            });
            html += '</ul>';

            container.innerHTML = html;
        }

        // ============================================================
        // FUN√á√ïES DE UTILIT√ÅRIOS
        // ============================================================
        function printDiagnosis() {
            window.print();
        }

        function resetForm() {
            if (confirm('Deseja iniciar um novo diagn√≥stico? Todos os dados ser√£o perdidos.')) {
                location.reload();
            }
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            // Pr√©-popular com valores padr√£o se necess√°rio
        });
    </script>
</body>
</html>